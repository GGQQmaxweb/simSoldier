<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¨¡æ“¬å¤§å…µï¼šå…¥ä¼ç”Ÿå­˜æ‰‹å†Š</title>
    
    <!-- è¼‰å…¥ React æ ¸å¿ƒ -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- è¼‰å…¥ Babel ç”¨æ–¼è§£æ JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- è¼‰å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        /* è‡ªå®šç¾©å‹•ç•« */
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.3s ease-out forwards;
        }
        
        /* éš±è—æ²è»¸ä½†ä¿ç•™åŠŸèƒ½ (Chromium) */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        /* éš±è—æ²è»¸ (Firefox) */
        .no-scrollbar {
            scrollbar-width: none;
        }
    </style>
</head>
<body class="bg-stone-950 text-stone-200 overflow-hidden">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- åœ–æ¨™çµ„ä»¶ (Icon Components) ---
        // ç‚ºäº†ä¸ä¾è³´å¤–éƒ¨æ¨¡çµ„ï¼Œå°‡æ‰€æœ‰ä½¿ç”¨åˆ°çš„ Lucide åœ–æ¨™æ‰‹å‹•å®šç¾©ç‚º React çµ„ä»¶
        
        const IconWrapper = ({ size = 24, className = "", children }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {children}
            </svg>
        );

        const User = (p) => <IconWrapper {...p}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></IconWrapper>;
        const Shield = (p) => <IconWrapper {...p}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></IconWrapper>;
        const Activity = (p) => <IconWrapper {...p}><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></IconWrapper>;
        const MessageSquare = (p) => <IconWrapper {...p}><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></IconWrapper>;
        const Briefcase = (p) => <IconWrapper {...p}><rect width="20" height="14" x="2" y="7" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></IconWrapper>;
        const FileText = (p) => <IconWrapper {...p}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></IconWrapper>;
        const CheckSquare = (p) => <IconWrapper {...p}><polyline points="9 11 12 14 22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></IconWrapper>;
        const Clock = (p) => <IconWrapper {...p}><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></IconWrapper>;
        const Dumbbell = (p) => <IconWrapper {...p}><path d="m6.5 6.5 11 11"/><path d="m21 21-1-1"/><path d="m3 3 1 1"/><path d="m18 22 4-4"/><path d="m2 6 4-4"/><path d="m3 10 7-7"/><path d="m14 21 7-7"/></IconWrapper>;
        const Play = (p) => <IconWrapper {...p}><polygon points="5 3 19 12 5 21 5 3"/></IconWrapper>;
        const AlertCircle = (p) => <IconWrapper {...p}><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></IconWrapper>;
        const Menu = (p) => <IconWrapper {...p}><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></IconWrapper>;
        const X = (p) => <IconWrapper {...p}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></IconWrapper>;
        const ChevronRight = (p) => <IconWrapper {...p}><path d="m9 18 6-6-6-6"/></IconWrapper>;
        const ShoppingBag = (p) => <IconWrapper {...p}><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"/><path d="M3 6h18"/><path d="M16 10a4 4 0 0 1-8 0"/></IconWrapper>;
        const Info = (p) => <IconWrapper {...p}><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></IconWrapper>;
        const Lock = (p) => <IconWrapper {...p}><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></IconWrapper>;
        const LogIn = (p) => <IconWrapper {...p}><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" x2="3" y1="12" y2="12"/></IconWrapper>;
        const Edit2 = (p) => <IconWrapper {...p}><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></IconWrapper>;
        const Settings = (p) => <IconWrapper {...p}><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></IconWrapper>;
        const Eye = (p) => <IconWrapper {...p}><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></IconWrapper>;
        const Calendar = (p) => <IconWrapper {...p}><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></IconWrapper>;
        const Scale = (p) => <IconWrapper {...p}><path d="m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1z"/><path d="m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1z"/><path d="M7 21h10"/><path d="M12 3v18"/><path d="M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2"/></IconWrapper>;
        const Ruler = (p) => <IconWrapper {...p}><path d="M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0l12.6 12.6z"/><line x1="14.5" x2="12.5" y1="9.4" y2="11.4"/><line x1="16.9" x2="14.9" y1="11.8" y2="13.8"/><line x1="10.1" x2="8.1" y1="5" y2="7"/></IconWrapper>;
        const Ban = (p) => <IconWrapper {...p}><circle cx="12" cy="12" r="10"/><path d="m4.9 4.9 14.2 14.2"/></IconWrapper>;
        const LogOut = (p) => <IconWrapper {...p}><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></IconWrapper>;
        const Gamepad2 = (p) => <IconWrapper {...p}><line x1="6" x2="10" y1="11" y2="11"/><line x1="8" x2="8" y1="9" y2="13"/><line x1="15" x2="15.01" y1="12" y2="12"/><line x1="18" x2="18.01" y1="10" y2="10"/><path d="M17.32 5H6.68a4 4 0 0 0-3.978 3.59c-.006.052-.01.101-.017.152C2.604 9.416 2 14.456 2 16a3 3 0 0 0 3 3c1 0 1.5-.5 2-1l1.414-1.414A2 2 0 0 1 9.828 16h4.344a2 2 0 0 1 1.414.586L17 18c.5.5 1 1 2 1a3 3 0 0 0 3-3c0-1.545-.604-6.584-.685-7.258-.007-.05-.011-.1-.017-.151A4 4 0 0 0 17.32 5z"/></IconWrapper>;
        const Bug = (p) => <IconWrapper {...p}><rect width="8" height="14" x="8" y="6" rx="4"/><path d="m19 7-3 2"/><path d="m5 7 3 2"/><path d="m19 19-3-2"/><path d="m5 19 3-2"/><path d="M20 13h-4"/><path d="M4 13h4"/><path d="m10 4 1 2"/><path d="m14 4-1 2"/></IconWrapper>;


        // --- è³‡æ–™èˆ‡é‚è¼¯ ---

        // æ¨¡æ“¬çš„é«”ä½åˆ¤å®šæ¨™æº–
        const determineServiceType = (bmi, role, disability) => {
            if (disability && disability !== 'none') return { type: 'å…å½¹', reason: 'èº«å¿ƒéšœç¤™è­‰æ˜', icon: 'ğŸ•Šï¸', nextStep: 'æŒèº«å¿ƒéšœç¤™è­‰æ˜è‡³å…¬æ‰€å…µå½¹ç§‘è¾¦ç†æ ¸å…' };
            if (role === 'parent_loss') return { type: 'è£œå……å…µ (12å¤©)', reason: 'å®¶åº­å› ç´ ', icon: 'ğŸ ', nextStep: 'æº–å‚™æˆ¶ç±è¬„æœ¬èˆ‡ç›¸é—œè­‰æ˜ç”³è«‹' };
            
            if (bmi < 16.5 || bmi > 31.5) return { type: 'å…å½¹', reason: 'é«”ä½ä¸åˆæ ¼ (éç˜¦/éé‡)', icon: 'ğŸ¥', nextStep: 'ç­‰å¾…é«”æª¢å ±å‘Šï¼Œå¯èƒ½éœ€è¤‡æª¢' };
            if ((bmi >= 16.5 && bmi < 17) || (bmi > 31 && bmi <= 31.5)) return { type: 'æ›¿ä»£å½¹', reason: 'æ›¿ä»£å½¹é«”ä½', icon: 'ğŸ‘®', nextStep: 'ç•™æ„æ›¿ä»£å½¹ç”³è«‹æ™‚ç¨‹' };
            
            return { type: 'å¸¸å‚™å½¹', reason: 'å¸¸å‚™å½¹é«”ä½', icon: 'ğŸª–', nextStep: 'é›éŠé«”èƒ½ï¼Œèª¿æ•´ä½œæ¯ï¼Œæº–å‚™å…¥ç‡Ÿ' };
        };

        // åˆå§‹è£å‚™æ¸…å–®
        const initialBackpack = [
            { id: 1, name: 'å¾µé›†ä»¤', acquired: true, category: 'å¿…å‚™' },
            { id: 2, name: 'èº«åˆ†è­‰', acquired: true, category: 'å¿…å‚™' },
            { id: 3, name: 'å¥ä¿å¡', acquired: true, category: 'å¿…å‚™' },
            { id: 4, name: 'ä¾¿å®œé›»å­éŒ¶', acquired: false, category: 'ç”Ÿæ´»' },
            { id: 5, name: 'ä¸‰åˆä¸€æ²æµ´ä¹³', acquired: false, category: 'ç”Ÿæ´»' },
            { id: 6, name: 'çˆ½èº«ç²‰', acquired: false, category: 'ç”Ÿæ´»' },
            { id: 7, name: 'å¥‡ç•°ç­† (å¯«åå­—)', acquired: false, category: 'ç”Ÿæ´»' },
            { id: 8, name: 'æ…¢æ€§ç—…è—¥ç‰©', acquired: false, category: 'é†«ç™‚' },
        ];

        // çŸ­å½±éŸ³å…§å®¹æ¨¡æ“¬
        const shortVideos = [
            { id: 1, title: 'è±†è…ä¹¾æ£‰è¢«æ•™å­¸', desc: 'æè§’ã€å£“ç·šã€æ‹‰å¹³ï¼åªè¦ä¸‰åˆ†é˜ï¼Œç­é•·ä¸æ‰£åˆ†ã€‚', tag: '#å…§å‹™', color: 'bg-blue-600' },
            { id: 2, title: 'æ´—æ¾¡å¤§ä½œæˆ°', desc: 'æ´—æ¾¡æ™‚é–“åªæœ‰5åˆ†é˜ï¼Ÿæ•™ä½ å¦‚ä½•ç”¨ä¸€ç½ä¸‰åˆä¸€æ´—æˆ°é¬¥æ¾¡ã€‚', tag: '#ç”Ÿæ´»', color: 'bg-green-600' },
            { id: 3, title: 'é˜²èšŠå¤§ä½œæˆ°', desc: 'é³³å±±/æˆåŠŸå¶ºçš„èšŠå­æœ‰ç·¨è™Ÿï¼Ÿé˜²èšŠæ¶²è¦é€™æ¨£å™´æ‰æœ‰æ•ˆï¼', tag: '#ç”Ÿå­˜', color: 'bg-yellow-600' },
            { id: 4, title: 'æ‰“é£¯ç­çš„ç§˜å¯†', desc: 'é›–ç„¶ç´¯ä½†å¯ä»¥åƒé£½ï¼Œé‚„å¯ä»¥å·å–é£²æ–™ï¼Ÿ', tag: '#å…¬å·®', color: 'bg-red-600' },
        ];

        // æ•™å®˜å›æ‡‰è³‡æ–™åº«
        const instructorResponses = {
            default: ["å¤§è²é»æˆ‘è½ä¸è¦‹ï¼", "é‚„åœ¨å•ï¼Ÿä¸æœƒçœ‹æº–å‰‡å•Šï¼", "é€™å€‹å•é¡Œå¾ˆå¥½ï¼Œä½†æˆ‘ä¸æƒ³å›ç­”ä½ ã€‚", "å»å•ä½ çš„è¼”å°é•·ï¼"],
            medical: ["èº«é«”æœ‰ç—…ç—›å°±å»çœ‹é†«å®˜ï¼Œä¸è¦æ’ï¼", "é™¤éä½ æ–·æ‰‹æ–·è…³ï¼Œä¸ç„¶åœ‹è»æ­¡è¿ä½ ã€‚", "é–‹ç«‹è­‰æ˜ï¼Œå¸¶è‘—è­‰æ˜å»é«”æª¢ï¼Œä¸è¦å•æˆ‘ï¼"],
            gf: ["å…µè®Šæ˜¯å¿…ç¶“ä¹‹è·¯ï¼Œçœ‹é–‹é»ï¼", "ä½ çš„å¥³æœ‹å‹ç¾åœ¨æ˜¯å¤§å®¶çš„äº†ï¼ˆèª¤ï¼‰ï¼Œå°ˆå¿ƒæ“èª²ï¼", "æ‰“é›»è©±æ™‚é–“åªæœ‰10åˆ†é˜ï¼Œè‡ªå·±æŠŠæ¡ã€‚"],
            single_ball: ["é™¤éä½ æœ‰è¡Œå‹•ä¸ä¾¿ï¼Œå¦å‰‡å°‘ä¸€é¡†é‚„æ˜¯ç”·äººï¼Œçµ¦æˆ‘å…¥åˆ—ï¼", "åªè¦åŠŸèƒ½æ­£å¸¸ï¼Œåœ‹å®¶éœ€è¦ä½ ï¼"],
            item: ["å¸¶é‚£ä»€éº¼é•ç¦å“ï¼Ÿæ‰‹æ©Ÿäº¤å‡ºä¾†çŒMDMï¼", "é›¶é£Ÿï¼Ÿä½ ä»¥ç‚ºæ˜¯ä¾†éƒŠéŠçš„å•Šï¼Ÿ"],
        };

        // é«”èƒ½è¨“ç·´è¨ˆç•«
        const trainingPlan = [
            { day: 1, title: 'é©æ‡‰æœŸï¼šæ ¸å¿ƒå•Ÿå‹•', content: 'ä¼åœ°æŒºèº« 10ä¸‹ x 3çµ„ã€æ£’å¼ 30ç§’' },
            { day: 2, title: 'é©æ‡‰æœŸï¼šä¸‹è‚¢è‚ŒåŠ›', content: 'æ·±è¹² 15ä¸‹ x 3çµ„ã€é–‹åˆè·³ 50ä¸‹' },
            { day: 3, title: 'å¼·åŒ–æœŸï¼šå¿ƒè‚ºè€åŠ›', content: 'æ…¢è·‘ 15åˆ†é˜ (é…é€Ÿ 7åˆ†é€Ÿ)' },
            { day: 4, title: 'å¼·åŒ–æœŸï¼šä¸Šè‚¢æ¨åŠ›', content: 'ä¼åœ°æŒºèº« 15ä¸‹ x 3çµ„ã€æ¿å‡³æ’é«” 10ä¸‹' },
            { day: 5, title: 'æ¢å¾©æœŸï¼šä¼¸å±•æ”¾é¬†', content: 'å…¨èº«éœæ…‹ä¼¸å±• 20åˆ†é˜ï¼Œæ—©é»ç¡è¦º' },
        ];

        // --- ä¸»æ‡‰ç”¨ç¨‹å¼ (App) ---

        const App = () => {
            // State
            const [step, setStep] = useState('dashboard');
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            
            // è¨­å®šé è¨­æ—¥æœŸç‚ºä»Šå¤©å¾€å¾Œæ¨ 30 å¤©
            const defaultDate = new Date();
            defaultDate.setDate(defaultDate.getDate() + 30);
            const defaultDateStr = defaultDate.toISOString().split('T')[0];

            const [userData, setUserData] = useState({
                name: '',
                role: 'student',
                height: 175,
                weight: 70,
                vision: 1.0,
                disabilityType: 'none',
                enlistmentDate: defaultDateStr,
            });

            const [serviceStatus, setServiceStatus] = useState(null);
            const [activeTab, setActiveTab] = useState('home');
            const [backpack, setBackpack] = useState(initialBackpack);
            const [messages, setMessages] = useState([
                { id: 1, sender: 'instructor', text: 'æ­»èœé³¥ï¼æœ‰ä»€éº¼å•é¡Œå¿«å•ï¼ä¸è¦æµªè²»æˆ‘æ™‚é–“ï¼' }
            ]);
            const [inputText, setInputText] = useState('');
            const [currentVideo, setCurrentVideo] = useState(null);
            
            // å…å½¹ç›¸é—œçš„ã€Œå¥½å¥‡æŸ¥çœ‹ã€ç‹€æ…‹
            const [showFullBackpack, setShowFullBackpack] = useState(false);
            const [showFullTraining, setShowFullTraining] = useState(false);
            const [showFakeCountdown, setShowFakeCountdown] = useState(false);

            // éŠæˆ²ç›¸é—œ State
            const [gameData, setGameData] = useState({
                isPlaying: false,
                isGameOver: false,
                score: 0,
                timeLeft: 30,
                mosquitoes: [] // {id, top, left}
            });
            const gameTimerRef = useRef(null);
            const spawnTimerRef = useRef(null);

            // Refs
            const chatEndRef = useRef(null);

            // Effects
            useEffect(() => {
                if (chatEndRef.current) {
                chatEndRef.current.scrollIntoView({ behavior: 'smooth' });
                }
            }, [messages]);

            // Game Logic Effects
            useEffect(() => {
                if (gameData.isPlaying && gameData.timeLeft > 0) {
                gameTimerRef.current = setInterval(() => {
                    setGameData(prev => ({
                    ...prev,
                    timeLeft: prev.timeLeft - 1
                    }));
                }, 1000);

                spawnTimerRef.current = setInterval(() => {
                    setGameData(prev => {
                    if (prev.mosquitoes.length >= 6) return prev; // ç•«é¢ä¸Šæœ€å¤š6éš»
                    const newBug = {
                        id: Date.now(),
                        top: Math.random() * 80 + 10, // 10% - 90% height
                        left: Math.random() * 80 + 10 // 10% - 90% width
                    };
                    return {
                        ...prev,
                        mosquitoes: [...prev.mosquitoes, newBug]
                    };
                    });
                }, 700); // æ¯0.7ç§’ç”Ÿæˆä¸€éš»
                } else if (gameData.timeLeft === 0 && gameData.isPlaying) {
                endGame();
                }

                return () => {
                clearInterval(gameTimerRef.current);
                clearInterval(spawnTimerRef.current);
                };
            }, [gameData.isPlaying, gameData.timeLeft]);

            // Handlers
            const handleInputChange = (e) => {
                const { name, value } = e.target;
                setUserData(prev => ({ ...prev, [name]: value }));
            };

            const calculateResults = () => {
                const bmi = (userData.weight / ((userData.height / 100) ** 2)).toFixed(1);
                const status = determineServiceType(parseFloat(bmi), userData.role, userData.disabilityType);
                setServiceStatus({ ...status, bmi });
                setIsLoggedIn(true);
                setStep('dashboard');
                setShowFullBackpack(false);
                setShowFullTraining(false);
                setShowFakeCountdown(false);
            };

            const getDaysLeft = () => {
                if (!userData.enlistmentDate) return 30;
                const today = new Date();
                const target = new Date(userData.enlistmentDate);
                const diffTime = target - today;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
                return diffDays > 0 ? diffDays : 0;
            };

            const toggleItem = (id) => {
                setBackpack(prev => prev.map(item => 
                item.id === id ? { ...item, acquired: !item.acquired } : item
                ));
            };

            const handleChatSubmit = (e) => {
                e.preventDefault();
                if (!inputText.trim()) return;

                const newMsg = { id: Date.now(), sender: 'user', text: inputText };
                setMessages(prev => [...prev, newMsg]);

                setTimeout(() => {
                let reply = '';
                const lowerText = inputText.toLowerCase();
                
                if (lowerText.includes('å–®çª') || lowerText.includes('çªä¸¸')) {
                    reply = instructorResponses.single_ball[Math.floor(Math.random() * instructorResponses.single_ball.length)];
                } else if (lowerText.includes('å¥³å‹') || lowerText.includes('åˆ†æ‰‹') || lowerText.includes('å…µè®Š')) {
                    reply = instructorResponses.gf[Math.floor(Math.random() * instructorResponses.gf.length)];
                } else if (lowerText.includes('ç—…') || lowerText.includes('ç—›') || lowerText.includes('è—¥')) {
                    reply = instructorResponses.medical[Math.floor(Math.random() * instructorResponses.medical.length)];
                } else if (lowerText.includes('æ‰‹æ©Ÿ') || lowerText.includes('è¸') || lowerText.includes('å¸¶')) {
                    reply = instructorResponses.item[Math.floor(Math.random() * instructorResponses.item.length)];
                } else {
                    reply = instructorResponses.default[Math.floor(Math.random() * instructorResponses.default.length)];
                }

                setMessages(prev => [...prev, { id: Date.now() + 1, sender: 'instructor', text: reply }]);
                }, 800);

                setInputText('');
            };

            const handleLoginStart = () => {
                setStep('onboarding');
            };

            const handleLogout = () => {
                setIsLoggedIn(false);
                setServiceStatus(null);
                setStep('dashboard');
                setShowFullBackpack(false);
                setShowFullTraining(false);
                setShowFakeCountdown(false);
            };

            // Game Functions
            const startGame = () => {
                setGameData({
                isPlaying: true,
                isGameOver: false,
                score: 0,
                timeLeft: 30,
                mosquitoes: []
                });
            };

            const endGame = () => {
                setGameData(prev => ({
                ...prev,
                isPlaying: false,
                isGameOver: true,
                mosquitoes: []
                }));
                clearInterval(gameTimerRef.current);
                clearInterval(spawnTimerRef.current);
            };

            const hitMosquito = (id) => {
                setGameData(prev => ({
                ...prev,
                score: prev.score + 10,
                mosquitoes: prev.mosquitoes.filter(m => m.id !== id)
                }));
            };

            // --- ç•«é¢æ¸²æŸ“ ---

            // 1. ç™»å…¥/åŸºæœ¬è³‡æ–™é é¢ (Modal Style for Desktop)
            if (step === 'onboarding') {
                return (
                <div className="fixed inset-0 z-50 bg-black/80 flex items-center justify-center p-4 font-mono backdrop-blur-sm">
                    <div className="max-w-md w-full bg-stone-800 rounded-lg border-2 border-green-700 shadow-2xl overflow-hidden animate-fade-in">
                        <div className="bg-green-800 p-4 text-center relative">
                            <button onClick={() => setStep('dashboard')} className="absolute left-4 top-4 text-green-200 hover:text-white">
                            <X size={24} />
                            </button>
                            <h1 className="text-2xl font-bold tracking-widest text-white">
                            {isLoggedIn ? 'å…µç±è³‡æ–™ä¿®æ”¹' : 'å…µç±è³‡æ–™å»ºç«‹'}
                            </h1>
                            <p className="text-green-200 text-sm">
                            {isLoggedIn ? 'æ›´æ–°è³‡æ–™å°‡é‡æ–°è¨ˆç®—é«”ä½' : 'è¼¸å…¥è³‡æ–™ä»¥å•Ÿç”¨å®Œæ•´åŠŸèƒ½'}
                            </p>
                        </div>
                        
                        <div className="p-6 space-y-4">
                            <div>
                            <label className="block text-sm text-stone-400 mb-1">å§“å</label>
                            <input type="text" name="name" value={userData.name} onChange={handleInputChange} className="w-full bg-stone-900 border border-stone-600 rounded p-2 focus:border-green-500 focus:outline-none" placeholder="ç‹å°æ˜" />
                            </div>

                            <div>
                            <label className="block text-sm text-stone-400 mb-1">é è¨ˆå…¥ä¼æ—¥æœŸ (å¯ç•¥ä¼°)</label>
                            <div className="relative">
                                <input 
                                type="date" 
                                name="enlistmentDate" 
                                value={userData.enlistmentDate} 
                                onChange={handleInputChange} 
                                className="w-full bg-stone-900 border border-stone-600 rounded p-2 focus:border-green-500 focus:outline-none text-white pl-10" 
                                />
                                <div className="absolute left-3 top-2.5 text-stone-500"><Calendar size={16} /></div>
                            </div>
                            </div>

                            <div>
                            <label className="block text-sm text-stone-400 mb-1">èº«åˆ†</label>
                            <select name="role" value={userData.role} onChange={handleInputChange} className="w-full bg-stone-900 border border-stone-600 rounded p-2 focus:border-green-500 focus:outline-none">
                                <option value="student">ä¸€èˆ¬å¤§å­¸ç”Ÿ</option>
                                <option value="overseas">æµ·å¤–ç•™å­¸ç”Ÿ</option>
                                <option value="parent_loss">å®¶å±¬ (å–ªè¦ª/éœ€ç…§é¡§)</option>
                                <option value="disability">èº«å¿ƒéšœç¤™è€…</option>
                            </select>
                            </div>

                            {userData.role === 'disability' && (
                            <div>
                            <label className="block text-sm text-stone-400 mb-1">éšœç¤™é¡åˆ¥</label>
                            <select name="disabilityType" value={userData.disabilityType} onChange={handleInputChange} className="w-full bg-stone-900 border border-stone-600 rounded p-2 focus:border-green-500 focus:outline-none">
                                <option value="none">è«‹é¸æ“‡</option>
                                <option value="physical">è‚¢é«”éšœç¤™</option>
                                <option value="mental">æ™ºèƒ½/ç²¾ç¥éšœç¤™ (å¦‚å”æ°ç—‡)</option>
                                <option value="visual">è¦–éšœ</option>
                            </select>
                            </div>
                            )}

                            <div className="grid grid-cols-2 gap-4">
                            <div>
                                <label className="block text-sm text-stone-400 mb-1">èº«é«˜ (cm)</label>
                                <input type="number" name="height" value={userData.height} onChange={handleInputChange} className="w-full bg-stone-900 border border-stone-600 rounded p-2" />
                            </div>
                            <div>
                                <label className="block text-sm text-stone-400 mb-1">é«”é‡ (kg)</label>
                                <input type="number" name="weight" value={userData.weight} onChange={handleInputChange} className="w-full bg-stone-900 border border-stone-600 rounded p-2" />
                            </div>
                            </div>

                            <button onClick={calculateResults} className="w-full bg-green-700 hover:bg-green-600 text-white font-bold py-3 rounded mt-4 transition-colors">
                            {isLoggedIn ? 'æ›´æ–°è³‡æ–™ä¸¦é‡æ–°åˆ¤å®š' : 'ç¢ºèªè³‡æ–™ä¸¦ç™»å…¥'}
                            </button>
                            <p className="text-xs text-center text-stone-500 mt-2">*æ­¤ç³»çµ±åƒ…ä¾›æ¨¡æ“¬åƒè€ƒï¼Œå¯¦éš›ä¾å…§æ”¿éƒ¨å½¹æ”¿å¸ç‚ºæº–</p>
                        </div>
                    </div>
                </div>
                );
            }

            // 2. ä¸»å„€è¡¨æ¿ (Dashboard)
            // Layout: Flex row for desktop (Sidebar + Main Content), Column for mobile
            return (
                <div className="flex h-screen bg-stone-950 text-stone-200 font-sans overflow-hidden">
                    
                    {/* æ¡Œæ©Ÿç‰ˆå´é‚Šæ¬„ (Desktop Sidebar) */}
                    <aside className="hidden md:flex flex-col w-64 bg-stone-900 border-r border-stone-800 shrink-0">
                        <div className="p-6 border-b border-stone-800">
                             <h1 className="text-xl font-bold text-white tracking-widest flex items-center gap-2">
                                <div className="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                                æ¨¡æ“¬å¤§å…µ
                             </h1>
                             <p className="text-xs text-stone-500 mt-1">å…¥ä¼ç”Ÿå­˜æ‰‹å†Š v1.0</p>
                        </div>

                        <nav className="flex-1 p-4 space-y-2 overflow-y-auto">
                             {[
                                { id: 'home', icon: <Activity size={20}/>, label: 'æˆ°æƒ…å„€è¡¨æ¿' },
                                { id: 'training', icon: <Dumbbell size={20}/>, label: 'é«”èƒ½è¨“ç·´' },
                                { id: 'inventory', icon: <Briefcase size={20}/>, label: 'å…¥ä¼èƒŒåŒ…' },
                                { id: 'chat', icon: <MessageSquare size={20}/>, label: 'æ•™å®˜èŠå¤©å®¤' },
                                { id: 'docs', icon: <Menu size={20}/>, label: 'è¡Œæ”¿ä¸­å¿ƒ' },
                             ].map(item => (
                                <button
                                    key={item.id}
                                    onClick={() => setActiveTab(item.id)}
                                    className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-all ${
                                        activeTab === item.id 
                                        ? 'bg-green-900/30 text-green-400 border border-green-800/50' 
                                        : 'text-stone-400 hover:bg-stone-800 hover:text-stone-200'
                                    }`}
                                >
                                    {item.icon}
                                    <span className="font-bold text-sm">{item.label}</span>
                                </button>
                             ))}
                        </nav>

                        {/* æ¡Œæ©Ÿç‰ˆç”¨æˆ¶è³‡è¨Šå€å¡Š */}
                        <div className="p-4 border-t border-stone-800 bg-stone-900/50">
                             {isLoggedIn ? (
                                <div className="flex items-center gap-3">
                                    <div className="bg-green-800 p-2 rounded-full text-white">
                                        <User size={20} />
                                    </div>
                                    <div className="flex-1 min-w-0">
                                        <p className="text-sm font-bold truncate text-white">{userData.name}</p>
                                        <p className="text-xs text-green-500 truncate">{serviceStatus?.type}</p>
                                    </div>
                                </div>
                             ) : (
                                <button onClick={handleLoginStart} className="w-full bg-stone-800 hover:bg-stone-700 text-stone-300 py-2 rounded text-sm flex items-center justify-center gap-2">
                                    <LogIn size={16}/> é»æ­¤ç™»å…¥
                                </button>
                             )}
                        </div>
                    </aside>


                    {/* ä¸»å…§å®¹å€åŸŸ (Main Content Area) */}
                    <div className="flex-1 flex flex-col relative overflow-hidden h-full">
                        
                        {/* æ‰‹æ©Ÿç‰ˆ Header (ç¶­æŒåŸæœ¬) / æ¡Œæ©Ÿç‰ˆ Top Bar (åŠŸèƒ½æŒ‰éˆ•) */}
                        <header className="bg-stone-900 border-b border-stone-800 p-4 shrink-0 flex justify-between items-center z-10 shadow-md">
                            {/* Mobile Logo / Title */}
                            <div className="flex items-center gap-2 md:hidden">
                                <div className="bg-green-700 p-2 rounded-full">
                                    <User size={20} className="text-white" />
                                </div>
                                <div>
                                    <h2 className="font-bold text-sm">
                                    {isLoggedIn ? `äºŒå…µ ${userData.name}` : 'è¨ªå®¢'}
                                    </h2>
                                    <div className="flex items-center gap-1 text-xs text-stone-400">
                                    {isLoggedIn ? (
                                        <>
                                        <span className="bg-stone-800 px-1 rounded">BMI: {serviceStatus?.bmi}</span>
                                        <span className={`font-bold ${serviceStatus?.type === 'å…å½¹' ? 'text-green-400' : 'text-green-600'}`}>
                                            {serviceStatus?.type}
                                        </span>
                                        </>
                                    ) : (
                                        <span className="text-stone-500">å°šæœªå»ºç«‹å…µç±è³‡æ–™</span>
                                    )}
                                    </div>
                                </div>
                            </div>

                            {/* Desktop Title (Left side of header, though mostly for spacing) */}
                            <div className="hidden md:block text-stone-400 text-sm">
                                {activeTab === 'home' && 'æˆ°æƒ…ä¸­å¿ƒ'}
                                {activeTab === 'training' && 'é«”èƒ½è¨“ç·´è¨ˆç•«'}
                                {activeTab === 'inventory' && 'è£å‚™æª¢æŸ¥'}
                                {activeTab === 'chat' && 'å€¼æ˜Ÿæ•™å®˜å®¤'}
                                {activeTab === 'docs' && 'è¡Œæ”¿è³‡æº'}
                                {(activeTab === 'game' || activeTab === 'video') && 'å¨›æ¨‚å®¤'}
                            </div>
                            
                            {/* Action Buttons (Both Mobile and Desktop) */}
                            <div>
                            {!isLoggedIn ? (
                                <button onClick={handleLoginStart} className="text-xs bg-stone-800 hover:bg-stone-700 border border-stone-600 px-3 py-1.5 rounded flex items-center gap-1 transition-colors">
                                <LogIn size={12}/> <span className="hidden md:inline">ç™»å…¥/è¨­å®š</span><span className="md:hidden">ç™»å…¥</span>
                                </button>
                            ) : (
                                <div className="flex gap-2">
                                    <button onClick={handleLoginStart} className="text-xs bg-stone-800 hover:bg-stone-700 border border-stone-600 px-3 py-1.5 rounded flex items-center gap-1 transition-colors text-stone-300">
                                    <Edit2 size={12}/> <span className="hidden md:inline">ä¿®æ”¹è³‡æ–™</span>
                                    </button>
                                    <button onClick={handleLogout} className="text-xs bg-red-900/30 hover:bg-red-900/50 border border-red-800 px-3 py-1.5 rounded flex items-center gap-1 transition-colors text-red-200">
                                    <LogOut size={12}/> <span className="hidden md:inline">ç™»å‡º</span>
                                    </button>
                                </div>
                            )}
                            </div>
                        </header>

                        {/* æ²å‹•å…§å®¹å€å¡Š */}
                        <div className="flex-1 overflow-y-auto p-4 md:p-8 scroll-smooth">
                            <div className="max-w-6xl mx-auto w-full space-y-6 pb-20 md:pb-0">

                                {/* 1. æˆ°æƒ…æ‘˜è¦ (Home Tab) - Grid Layout for Desktop */}
                                {activeTab === 'home' && (
                                <div className="grid grid-cols-1 lg:grid-cols-12 gap-6">
                                    
                                    {/* å·¦æ¬„ï¼šç‹€æ…‹èˆ‡è³‡è¨Š (4 cols) */}
                                    <div className="lg:col-span-4 space-y-6">
                                        {/* åˆ¤å®šçµæœå¡ç‰‡ (éœ€ç™»å…¥) */}
                                        {isLoggedIn ? (
                                        <div className={`bg-stone-900 border-l-4 ${serviceStatus?.type === 'å…å½¹' ? 'border-green-500' : 'border-green-700'} p-5 rounded-lg shadow-lg`}>
                                            <div className="flex justify-between items-start mb-4">
                                            <h3 className="font-bold text-lg text-white">å…µå½¹æ¨ä¼°å ±å‘Š</h3>
                                            <span className="text-3xl">{serviceStatus?.icon}</span>
                                            </div>
                                            <p className={`${serviceStatus?.type === 'å…å½¹' ? 'text-green-400' : 'text-green-600'} font-bold text-2xl mb-2`}>{serviceStatus?.type}</p>
                                            <p className="text-stone-400 text-sm mb-4">åˆ¤å®šä¾æ“šï¼š{serviceStatus?.reason}</p>
                                            
                                            <div className="bg-stone-800 p-3 rounded text-sm text-stone-300">
                                            <p className="font-bold text-yellow-500 mb-1 flex items-center gap-1"><AlertCircle size={14}/> æŒ‡ç¤ºï¼š</p>
                                            {serviceStatus?.nextStep}
                                            </div>
                                        </div>
                                        ) : (
                                        <div className="bg-stone-900 border-l-4 border-stone-600 p-6 rounded-lg shadow-lg flex flex-col items-center text-center space-y-4">
                                            <div className="bg-stone-800 p-4 rounded-full"><Shield size={40} className="text-stone-500"/></div>
                                            <div>
                                                <h3 className="font-bold text-lg text-white">å…µå½¹æ¨ä¼°ç³»çµ±</h3>
                                                <p className="text-stone-400 text-sm">è¼¸å…¥èº«é«˜é«”é‡ï¼Œç«‹å³é æ¸¬æ‚¨çš„å½¹åˆ¥</p>
                                            </div>
                                            <button onClick={handleLoginStart} className="w-full bg-green-700 hover:bg-green-600 text-white font-bold py-2 rounded transition-colors">
                                                å»ºç«‹è³‡æ–™ä»¥è§£é–
                                            </button>
                                        </div>
                                        )}

                                        {/* å€’æ•¸è¨ˆæ™‚å¡ç‰‡ */}
                                        <div className={`bg-stone-900 p-5 rounded-lg shadow-lg border ${serviceStatus?.type === 'å…å½¹' && !showFakeCountdown ? 'border-green-900' : 'border-stone-800'}`}>
                                            <div className="flex justify-between items-center mb-4">
                                                <h3 className="font-bold text-white flex items-center gap-2">
                                                    <Clock size={18} className={isLoggedIn && (serviceStatus?.type !== 'å…å½¹' || showFakeCountdown) ? "text-red-500" : "text-stone-500"}/> 
                                                    {serviceStatus?.type === 'å…å½¹' && !showFakeCountdown ? 'å…µå½¹ç‹€æ…‹' : 'è·é›¢å…¥ä¼'}
                                                </h3>
                                                {isLoggedIn && (serviceStatus?.type !== 'å…å½¹' || showFakeCountdown) && <span className="text-xs text-stone-500">ç›®æ¨™ï¼š{userData.enlistmentDate}</span>}
                                                
                                                {isLoggedIn && serviceStatus?.type === 'å…å½¹' && showFakeCountdown && (
                                                    <button onClick={() => setShowFakeCountdown(false)} className="text-xs text-stone-400 flex items-center gap-1">
                                                        <X size={12}/> çµæŸé«”é©—
                                                    </button>
                                                )}
                                            </div>
                                            
                                            {isLoggedIn ? (
                                                (serviceStatus?.type === 'å…å½¹' && !showFakeCountdown) ? (
                                                <div className="bg-stone-950 rounded-lg p-6 text-center border border-green-900">
                                                    <div className="font-mono text-3xl text-green-500 font-bold tracking-widest">
                                                        ç„¡éœ€å…¥ä¼
                                                    </div>
                                                    <p className="text-xs text-green-700 mt-2 mb-4">æ­å–œï¼æ‚¨å·²ç¬¦åˆå…å½¹æ¨™æº–</p>
                                                    <button 
                                                        onClick={() => setShowFakeCountdown(true)}
                                                        className="text-xs bg-stone-900 hover:bg-stone-800 border border-stone-700 px-4 py-2 rounded text-stone-400 transition-colors flex items-center gap-2 mx-auto"
                                                    >
                                                        <Eye size={12}/> é«”é©—å…¥ä¼ç·Šå¼µæ„Ÿ
                                                    </button>
                                                </div>
                                                ) : (
                                                <div className="bg-stone-950 rounded-lg p-6 text-center border border-stone-800">
                                                    <div className="font-mono text-5xl text-red-500 font-bold tracking-widest animate-pulse mb-2">
                                                        {getDaysLeft()} <span className="text-base text-stone-500 font-sans font-normal align-middle">å¤©</span>
                                                    </div>
                                                    <p className="text-xs text-stone-500">æ™‚é–“ä¸ç­‰äººï¼Œå¿«æª¢æŸ¥èƒŒåŒ…ï¼</p>
                                                </div>
                                                )
                                            ) : (
                                                <div className="bg-stone-950 rounded-lg p-6 text-center border border-stone-800 flex flex-col items-center justify-center h-32">
                                                    <p className="text-stone-500 text-sm mb-3">å°šæœªè¨­å®šå…¥ä¼æ—¥æœŸ</p>
                                                    <button onClick={handleLoginStart} className="text-xs text-green-500 hover:underline">
                                                    å‰å¾€è¨­å®š
                                                    </button>
                                                </div>
                                            )}
                                        </div>

                                        {/* æ³•è¦å°æ•™å®¤ (åªåœ¨æ¡Œæ©Ÿç‰ˆå·¦å´é¡¯ç¤ºï¼Œæˆ–æ‰‹æ©Ÿç‰ˆä¸‹æ–¹) */}
                                        <div className="bg-stone-900 p-4 rounded-lg shadow-lg border border-stone-800 hidden lg:block">
                                            <div className="flex items-center gap-2 mb-4 border-b border-stone-800 pb-2">
                                            <Info size={18} className="text-blue-400" />
                                            <h3 className="font-bold text-white text-sm">å½¹æ”¿æ³•è¦å°æ•™å®¤</h3>
                                            </div>
                                            <div className="space-y-3">
                                                <div className="flex items-start gap-3">
                                                <div className="bg-stone-800 p-1.5 rounded text-blue-400 mt-0.5"><Scale size={14}/></div>
                                                <div>
                                                    <p className="text-sm font-bold text-stone-200">1. é«”æ ¼æŒ‡æ¨™ (BMI)</p>
                                                    <p className="text-xs text-stone-500">éé«˜/éä½é”ä¸é©æœå½¹æ¨™æº–</p>
                                                </div>
                                                </div>
                                                <div className="flex items-start gap-3">
                                                <div className="bg-stone-800 p-1.5 rounded text-red-400 mt-0.5"><Ban size={14}/></div>
                                                <div>
                                                    <p className="text-sm font-bold text-stone-200">5. ç¦å½¹ (å‰ç§‘)</p>
                                                    <p className="text-xs text-stone-500">æ›¾åˆ¤åˆ‘5å¹´ä»¥ä¸Š</p>
                                                </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    {/* å³æ¬„ï¼šä»»å‹™èˆ‡å¨›æ¨‚ (8 cols) */}
                                    <div className="lg:col-span-8 space-y-6">
                                        
                                        {/* å€’æ•¸ä»»å‹™ */}
                                        <div className={`bg-stone-900 p-6 rounded-lg shadow-lg ${!isLoggedIn ? 'opacity-50 pointer-events-none grayscale' : ''} relative`}>
                                            {!isLoggedIn && (
                                                <div className="absolute inset-0 flex items-center justify-center z-10">
                                                    <div className="bg-black/80 px-4 py-2 rounded flex items-center gap-2 text-white text-sm">
                                                        <Lock size={14}/> éœ€ç™»å…¥æª¢è¦–
                                                    </div>
                                                </div>
                                            )}
                                            
                                            <div className="flex justify-between items-center mb-4">
                                                <h3 className="font-bold text-white flex items-center gap-2 text-lg">
                                                <CheckSquare size={20} className="text-green-500"/> 
                                                {serviceStatus?.type === 'å…å½¹' && !showFakeCountdown ? 'å…å½¹è¡Œæ”¿æ‰‹çºŒ' : 'å…¥ä¼å€’æ•¸ä»»å‹™'}
                                                </h3>
                                                {isLoggedIn && serviceStatus?.type === 'å…å½¹' && showFakeCountdown && (
                                                    <span className="text-xs text-yellow-500 bg-yellow-900/20 px-2 py-0.5 rounded border border-yellow-800">
                                                        é«”é©—æ¨¡å¼
                                                    </span>
                                                )}
                                            </div>
                                            
                                            <div className="space-y-3">
                                                {serviceStatus?.type === 'å…å½¹' && !showFakeCountdown ? (
                                                <>
                                                    <div className="flex items-center gap-4 p-4 bg-stone-800 rounded-lg border border-green-900 hover:bg-stone-750 transition-colors">
                                                    <input type="checkbox" className="w-5 h-5 accent-green-600 cursor-pointer" />
                                                    <div className="flex-1">
                                                        <p className="font-bold text-green-300">é ˜å–å…å½¹è­‰æ˜æ›¸</p>
                                                        <p className="text-sm text-stone-500">å‰å¾€å…¬æ‰€å…µå½¹ç§‘é ˜å–æˆ–ç­‰å¾…æ›è™Ÿ</p>
                                                    </div>
                                                    <span className="text-xs bg-green-900 text-green-200 px-3 py-1 rounded-full">è¡Œæ”¿</span>
                                                    </div>
                                                    <div className="flex items-center gap-4 p-4 bg-stone-800 rounded-lg border border-stone-700">
                                                    <input type="checkbox" className="w-5 h-5 accent-green-600 cursor-pointer" />
                                                    <div className="flex-1">
                                                        <p className="font-bold text-stone-200">è¾¦ç†è­·ç…§å…µå½¹è¨»è¨˜å¡—éŠ·</p>
                                                        <p className="text-sm text-stone-500">å¦‚æœä¹‹å¾Œè¦å‡ºåœ‹ï¼Œè¨˜å¾—å»å¤–äº¤éƒ¨</p>
                                                    </div>
                                                    </div>
                                                </>
                                                ) : (
                                                <>
                                                    <div className="flex items-center gap-4 p-4 bg-stone-800 rounded-lg border border-stone-700 hover:bg-stone-750 transition-colors">
                                                    <input type="checkbox" className="w-5 h-5 accent-green-600 cursor-pointer" />
                                                    <div className="flex-1">
                                                        <p className="font-bold text-stone-200">å»é†«é™¢åšé«”æª¢</p>
                                                    </div>
                                                    <span className="text-xs bg-red-900 text-red-200 px-3 py-1 rounded-full">ç·Šæ€¥</span>
                                                    </div>
                                                    <div className="flex items-center gap-4 p-4 bg-stone-800 rounded-lg border border-stone-700 hover:bg-stone-750 transition-colors">
                                                    <input type="checkbox" className="w-5 h-5 accent-green-600 cursor-pointer" />
                                                    <div className="flex-1">
                                                        <p className="font-bold text-stone-200">èª¿æ•´ä½œæ¯ (22:00å°±å¯¢)</p>
                                                    </div>
                                                    <span className="text-xs bg-stone-700 text-stone-300 px-3 py-1 rounded-full">æ¯æ—¥</span>
                                                    </div>
                                                </>
                                                )}
                                            </div>
                                        </div>

                                        {/* å¨›æ¨‚å°ˆå€ */}
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            {/* çŸ­å½±éŸ³å…¥å£ */}
                                            <div className="bg-gradient-to-br from-purple-900 to-blue-900 p-6 rounded-lg shadow-lg relative overflow-hidden cursor-pointer h-40 flex flex-col justify-between group hover:shadow-xl transition-all" onClick={() => setActiveTab('video')}>
                                                <div className="absolute right-[-10px] top-[-10px] text-white opacity-10 group-hover:scale-110 transition-transform duration-500">
                                                <Play size={100} />
                                                </div>
                                                <div>
                                                    <h3 className="font-bold text-white text-xl z-10 mb-1">æ–°å…µç”Ÿå­˜ 60ç§’</h3>
                                                    <p className="text-stone-300 text-sm z-10">è»ä¸­é¬¼æ•…äº‹ã€å…§å‹™æŠ€å·§</p>
                                                </div>
                                                <div className="bg-white/10 backdrop-blur-sm text-white text-xs font-bold px-3 py-1.5 rounded-full w-fit flex items-center gap-1 group-hover:bg-white/20 transition-colors">
                                                <Play size={12} fill="currentColor"/> è§€çœ‹å½±ç‰‡
                                                </div>
                                            </div>

                                            {/* å°éŠæˆ²å…¥å£ */}
                                            <div className="bg-gradient-to-br from-orange-900 to-red-900 p-6 rounded-lg shadow-lg relative overflow-hidden cursor-pointer h-40 flex flex-col justify-between group hover:shadow-xl transition-all" onClick={() => setActiveTab('game')}>
                                                <div className="absolute right-[-10px] top-[-10px] text-white opacity-10 group-hover:scale-110 transition-transform duration-500">
                                                <Gamepad2 size={100} />
                                                </div>
                                                <div>
                                                    <h3 className="font-bold text-white text-xl z-10 mb-1">å¤§å…µç‹‚æƒ³æ›²</h3>
                                                    <p className="text-stone-300 text-sm z-10"></p>
                                                </div>
                                                <div className="bg-white/10 backdrop-blur-sm text-white text-xs font-bold px-3 py-1.5 rounded-full w-fit flex items-center gap-1 group-hover:bg-white/20 transition-colors">
                                                <Gamepad2 size={14}/> START GAME
                                                </div>
                                            </div>
                                        </div>
                                        
                                        {/* æ‰‹æ©Ÿç‰ˆæ‰æœƒé¡¯ç¤ºçš„æ³•è¦å°æ•™å®¤ (æ¡Œæ©Ÿç‰ˆåœ¨å·¦å´) */}
                                        <div className="bg-stone-900 p-4 rounded-lg shadow-lg border border-stone-800 lg:hidden">
                                            <div className="flex items-center gap-2 mb-4 border-b border-stone-800 pb-2">
                                            <Info size={18} className="text-blue-400" />
                                            <h3 className="font-bold text-white text-sm">å½¹æ”¿æ³•è¦å°æ•™å®¤</h3>
                                            </div>
                                            <div className="space-y-3">
                                                 {/* ... é‡è¤‡å…§å®¹ ... */}
                                                 <div className="text-xs text-stone-500">è©³è¦‹å·¦å´æˆ–ä¸‹æ–¹èªªæ˜...</div>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                                )}

                                {/* 2. èƒŒåŒ…ç³»çµ± (Inventory Tab) - Grid for Desktop */}
                                {activeTab === 'inventory' && (
                                <div className="bg-stone-900 p-6 rounded-lg min-h-[500px] shadow-lg">
                                    <h3 className="font-bold text-white mb-6 flex items-center gap-2 text-xl">
                                        <ShoppingBag size={24} className="text-green-500"/> å…¥ä¼èƒŒåŒ…æª¢æ ¸
                                    </h3>
                                    
                                    {!isLoggedIn && (
                                        <div className="mb-6 bg-yellow-900/30 border border-yellow-700 p-4 rounded-lg text-sm text-yellow-400 flex items-center gap-2">
                                            <Info size={18}/> è¨ªå®¢æ¨¡å¼ç„¡æ³•å„²å­˜æ¸…å–®é€²åº¦
                                        </div>
                                    )}

                                    {(serviceStatus?.type !== 'å…å½¹' || showFullBackpack) && (
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
                                        <div className="bg-stone-800 p-4 rounded-lg text-center border border-stone-700 cursor-pointer hover:bg-stone-700 hover:border-green-500 transition-all group"
                                            onClick={() => {
                                                if(!backpack.find(i => i.name === 'é›»å­éŒ¶')) {
                                                    setBackpack([...backpack, {id: 99, name: 'é›»å­éŒ¶', acquired: true, category: 'ç”Ÿæ´»'}])
                                                }
                                            }}>
                                            <div className="text-3xl mb-2 group-hover:scale-110 transition-transform">âŒš</div>
                                            <div className="font-bold text-white">ä¸€éµæ¡è³¼ç”Ÿæ´»çµ„</div>
                                            <div className="text-xs text-stone-500 mt-1">å«æ‰‹éŒ¶ã€æ²æµ´ä¹³ã€çˆ½èº«ç²‰</div>
                                        </div>
                                        <div className="bg-stone-800 p-4 rounded-lg text-center border border-stone-700 cursor-pointer hover:bg-stone-700 hover:border-green-500 transition-all group"
                                                onClick={() => {
                                                if(!backpack.find(i => i.name === 'è¨ºæ–·è­‰æ˜æ›¸')) {
                                                    setBackpack([...backpack, {id: 100, name: 'è¨ºæ–·è­‰æ˜æ›¸', acquired: true, category: 'é†«ç™‚'}])
                                                }
                                                }}>
                                            <div className="text-3xl mb-2 group-hover:scale-110 transition-transform">ğŸ’Š</div>
                                            <div className="font-bold text-white">ç”³è«‹æ…¢æ€§ç—…è—¥ç‰©</div>
                                            <div className="text-xs text-stone-500 mt-1">åŠ å…¥è¨ºæ–·è­‰æ˜æ›¸è‡³æ¸…å–®</div>
                                        </div>
                                        </div>
                                    )}

                                    {isLoggedIn && serviceStatus?.type === 'å…å½¹' && !showFullBackpack ? (
                                        <div className="text-center py-20 bg-stone-950 rounded-lg border border-stone-800">
                                            <span className="text-6xl mb-4 block">ğŸ‰</span>
                                            <h3 className="text-green-500 font-bold text-2xl">æ­å–œå…å½¹</h3>
                                            <p className="text-stone-500 mt-2 mb-6">æ‚¨ç„¡éœ€æº–å‚™ä»»ä½•å…¥ä¼ç”¨å“</p>
                                            <button 
                                                onClick={() => setShowFullBackpack(true)}
                                                className="bg-stone-800 hover:bg-stone-700 border border-stone-600 px-6 py-3 rounded-lg text-stone-300 transition-colors flex items-center gap-2 mx-auto"
                                            >
                                                <Eye size={18}/> å¥½å¥‡æŸ¥çœ‹å¸¸å‚™å…µæ¸…å–®
                                            </button>
                                        </div>
                                    ) : (
                                        <>
                                        {isLoggedIn && serviceStatus?.type === 'å…å½¹' && showFullBackpack && (
                                            <div className="mb-4 flex justify-between items-center">
                                                <p className="text-sm text-yellow-500 flex items-center gap-2"><Info size={16}/> æª¢è¦–æ¨¡å¼ï¼šå¸¸å‚™å…µæ¸…å–®</p>
                                                <button 
                                                    onClick={() => setShowFullBackpack(false)}
                                                    className="text-sm text-stone-400 hover:text-white flex items-center gap-1"
                                                >
                                                    <ChevronRight className="rotate-180" size={16}/> è¿”å›å…å½¹ç‹€æ…‹
                                                </button>
                                            </div>
                                        )}
                                        
                                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                                            {backpack.map(item => (
                                                <div key={item.id} onClick={() => toggleItem(item.id)} className={`flex justify-between items-center p-4 rounded-lg cursor-pointer transition-all border ${item.acquired ? 'bg-green-900/20 border-green-800' : 'bg-stone-800 border-stone-700 hover:border-stone-500'}`}>
                                                    <div className="flex items-center gap-3">
                                                        <div className={`w-5 h-5 rounded border flex items-center justify-center shrink-0 ${item.acquired ? 'bg-green-500 border-green-500' : 'border-stone-500'}`}>
                                                            {item.acquired && <CheckSquare size={14} className="text-black" />}
                                                        </div>
                                                        <span className={item.acquired ? 'text-green-300 line-through' : 'text-stone-200 font-medium'}>{item.name}</span>
                                                    </div>
                                                    <span className="text-xs text-stone-500 bg-stone-900 px-2 py-1 rounded shrink-0">{item.category}</span>
                                                </div>
                                            ))}
                                        </div>
                                        <div className="mt-6 p-4 bg-yellow-900/20 border border-yellow-700 rounded-lg text-sm text-yellow-500 flex items-start gap-2">
                                            <Ban size={18} className="shrink-0 mt-0.5"/>
                                            <p>é•ç¦å“æé†’ï¼šæ‰‹æ©Ÿ (éƒ¨åˆ†å‹è™Ÿ)ã€è—ç‰™è€³æ©Ÿã€é›»å‹•åˆ®é¬åˆ€ã€é¦™è¸ã€æ‰“ç«æ©Ÿè«‹å‹¿æ”¾å…¥èƒŒåŒ…ã€‚</p>
                                        </div>
                                        </>
                                    )}
                                </div>
                                )}

                                {/* 3. æ•™å®˜èŠå¤© (Chat Tab) */}
                                {activeTab === 'chat' && (
                                <div className="flex flex-col h-[calc(100vh-140px)] bg-stone-900 rounded-lg overflow-hidden border border-stone-800 shadow-xl">
                                    <div className="bg-stone-800 p-4 border-b border-stone-700 flex items-center gap-4">
                                        <div className="w-12 h-12 bg-green-800 rounded-full flex items-center justify-center font-bold text-2xl border-2 border-stone-600">å€¼</div>
                                        <div>
                                            <div className="font-bold text-lg">å€¼æ˜Ÿæ•™å®˜</div>
                                            <div className="text-xs text-green-500 flex items-center gap-1"><span className="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span> åœ¨ç·šç½µäººä¸­</div>
                                        </div>
                                    </div>
                                    
                                    <div className="flex-1 overflow-y-auto p-6 space-y-6 bg-stone-900/50">
                                        {messages.map(msg => (
                                            <div key={msg.id} className={`flex ${msg.sender === 'user' ? 'justify-end' : 'justify-start'}`}>
                                                <div className={`max-w-[80%] md:max-w-[60%] p-4 rounded-xl text-base ${msg.sender === 'user' ? 'bg-green-700 text-white rounded-br-none shadow-md' : 'bg-stone-700 text-stone-200 rounded-bl-none shadow-md'}`}>
                                                    {msg.text}
                                                </div>
                                            </div>
                                        ))}
                                        <div ref={chatEndRef} />
                                    </div>

                                    <form onSubmit={handleChatSubmit} className="p-4 bg-stone-800 border-t border-stone-700 flex gap-3">
                                        <input 
                                            type="text" 
                                            value={inputText}
                                            onChange={(e) => setInputText(e.target.value)}
                                            placeholder="å•å€‹ç™½ç™¡å•é¡Œ..."
                                            className="flex-1 bg-stone-900 text-white px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 border border-stone-700"
                                        />
                                        <button type="submit" className="bg-green-700 hover:bg-green-600 px-6 py-2 rounded-lg text-white font-bold transition-colors">
                                            ç™¼é€
                                        </button>
                                    </form>
                                </div>
                                )}

                                {/* 4. é«”èƒ½è¨“ç·´ (Training Tab) */}
                                {activeTab === 'training' && (
                                <div className="space-y-6">
                                        <div className="bg-stone-900 p-6 rounded-lg shadow-lg min-h-[500px]">
                                            <h3 className="font-bold text-white mb-4 flex items-center gap-2 text-xl">
                                                <Dumbbell size={24} className="text-green-500"/> èœé³¥ä¸ç´¯æˆç‹—è¨ˆç•«
                                            </h3>
                                            
                                            {/* å…å½¹é‚è¼¯èˆ‡åˆ‡æ›é¡¯ç¤º */}
                                            {serviceStatus?.type === 'å…å½¹' && !showFullTraining ? (
                                            <div className="text-center py-20 bg-stone-950 rounded-lg border border-stone-800">
                                                <span className="text-6xl mb-4 block">ğŸ–ï¸</span>
                                                <p className="text-green-400 font-bold mb-2 text-xl">å…å½¹å„ªæƒ ï¼šæ‚¨å¯ä»¥è·³éé«”èƒ½è¨“ç·´</p>
                                                <p className="text-stone-500 text-sm mb-6">ä½†ç‚ºäº†å¥åº·ï¼Œé‚„æ˜¯å»ºè­°æ‚¨å‹•ä¸€å‹•ã€‚</p>
                                                <button 
                                                    onClick={() => setShowFullTraining(true)}
                                                    className="bg-stone-800 hover:bg-stone-700 border border-stone-600 px-6 py-3 rounded-lg text-stone-300 transition-colors flex items-center gap-2 mx-auto"
                                                >
                                                    <Eye size={18}/> å¥½å¥‡æŸ¥çœ‹åœ°ç„èœå–®
                                                </button>
                                            </div>
                                            ) : (
                                            <>
                                                {serviceStatus?.type === 'å…å½¹' && showFullTraining && (
                                                <div className="mb-4 flex justify-between items-center">
                                                    <p className="text-sm text-yellow-500 flex items-center gap-2"><Info size={16}/> æª¢è¦–æ¨¡å¼ï¼šä¸€èˆ¬å…µè¨“ç·´</p>
                                                    <button 
                                                        onClick={() => setShowFullTraining(false)}
                                                        className="text-sm text-stone-400 hover:text-white flex items-center gap-1"
                                                    >
                                                        <ChevronRight className="rotate-180" size={16}/> è¿”å›å…å½¹ç‹€æ…‹
                                                    </button>
                                                </div>
                                                )}

                                                <p className="text-sm text-stone-400 mb-6">å…¥ä¼å‰ 30 å¤©é–‹å§‹åŸ·è¡Œï¼Œè®“ä½ æ–°è¨“ç¬¬ä¸€é€±å°±èƒ½è·Ÿä¸Šéƒ¨éšŠç¯€å¥ã€‚</p>
                                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                                    {trainingPlan.map((plan, idx) => (
                                                        <div key={idx} className="bg-stone-800 rounded-lg p-5 border-l-4 border-stone-600 hover:border-green-500 hover:bg-stone-750 transition-all group shadow-md">
                                                            <div className="flex justify-between items-center mb-3">
                                                                <span className="text-green-400 text-xs font-bold border border-green-800 px-2 py-1 rounded bg-green-900/20">Day {plan.day}</span>
                                                                <span className="text-stone-300 font-bold group-hover:text-white">{plan.title}</span>
                                                            </div>
                                                            <p className="text-stone-400 text-sm leading-relaxed">{plan.content}</p>
                                                        </div>
                                                    ))}
                                                </div>
                                            </>
                                            )}
                                        </div>
                                </div>
                                )}

                                {/* 5. è¡Œæ”¿ä¸­å¿ƒ (Docs Tab) */}
                                {activeTab === 'docs' && (
                                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                        <div className="bg-stone-900 p-6 rounded-lg shadow-lg">
                                            <h3 className="font-bold text-white mb-6 flex items-center gap-2 text-xl">
                                                <FileText size={24} className="text-green-500"/> å½¹æ”¿æ–‡ä»¶ä¸­å¿ƒ
                                            </h3>
                                            <div className="space-y-3">
                                                {['ç·©å¾µç”³è«‹æ›¸ä¸‹è¼‰', 'é«”ä½è¤‡æª¢æ¨™æº–è¡¨', 'å„ç¸£å¸‚å½¹æ”¿å–®ä½é€šè¨ŠéŒ„', 'è»äººæ¬Šç›Šæ‡¶äººåŒ…'].map((doc, i) => (
                                                    <div key={i} className="flex justify-between items-center p-4 bg-stone-800 rounded-lg hover:bg-stone-700 cursor-pointer border border-stone-700 hover:border-stone-500 transition-colors group">
                                                        <span className="text-stone-300 group-hover:text-white">{doc}</span>
                                                        <ChevronRight size={20} className="text-stone-500 group-hover:text-white" />
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                        <div className="bg-stone-900 p-6 rounded-lg shadow-lg">
                                            <h3 className="font-bold text-white mb-6 flex items-center gap-2 text-xl">
                                                <Shield size={24} className="text-blue-500"/> å¾Œå‚™èˆ‡æ•™å¬æé†’
                                            </h3>
                                            <div className="bg-stone-950/50 p-6 rounded-lg border border-stone-800">
                                                <p className="text-stone-300 mb-4 leading-relaxed">ç•¶å®Œå…µä¸æ˜¯çµæŸï¼é€€ä¼å¾Œ 8 å¹´å…§ä½ éƒ½æ˜¯å¾Œå‚™è»äººï¼Œåœ‹å®¶éš¨æ™‚å¯èƒ½éœ€è¦ä½ ï¼ˆæ•™å¬ï¼‰ã€‚</p>
                                                <ul className="text-sm text-stone-400 list-disc pl-5 space-y-2">
                                                    <li>æ•™å¬æœŸé–“è¦–åŒç¾å½¹è»äºº</li>
                                                    <li>å‡ºåœ‹æ—…éŠéœ€é¿é–‹æ•™å¬ä»¤ä¸‹é”æœŸé–“ï¼Œå¦å‰‡è¦–ç‚ºé€ƒé¿å¬é›†</li>
                                                    <li>æ¯å¹´è¨˜å¾—ä¸Šç¶²æŸ¥è©¢æ•™å¬è³‡è¨Š (é€šå¸¸å¹´åˆé–‹æ”¾æŸ¥è©¢)</li>
                                                    <li>ç„¡æ•…æœªåˆ°å°‡ç§»é€æ³•è¾¦</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* 6. çŸ­å½±éŸ³ (Video Overlay) */}
                                {activeTab === 'video' && (
                                    <div className="h-[calc(100vh-140px)] w-full bg-black rounded-lg relative overflow-hidden flex flex-col items-center justify-center border border-stone-800 shadow-2xl">
                                        {currentVideo ? (
                                            <div className={`w-full h-full ${currentVideo.color} p-8 flex flex-col justify-end pb-20 relative animate-fade-in`}>
                                                <button 
                                                    onClick={() => setCurrentVideo(null)}
                                                    className="absolute top-6 right-6 bg-black/50 hover:bg-black/70 p-3 rounded-full text-white z-10 transition-colors">
                                                    <X size={24} />
                                                </button>
                                                <div className="max-w-2xl">
                                                    <span className="bg-black/40 text-white px-3 py-1 rounded text-sm mb-3 inline-block backdrop-blur-md">{currentVideo.tag}</span>
                                                    <h2 className="text-4xl md:text-5xl font-bold text-white mb-4 shadow-sm">{currentVideo.title}</h2>
                                                    <p className="text-white/90 text-xl leading-relaxed max-w-xl drop-shadow-md">{currentVideo.desc}</p>
                                                </div>
                                                <div className="flex gap-4 text-white/70 text-sm mt-6">
                                                    <span className="flex items-center gap-1">â¤ï¸ 1.2k</span>
                                                    <span className="flex items-center gap-1">ğŸ’¬ 342</span>
                                                </div>
                                            </div>
                                        ) : (
                                            <div className="w-full h-full bg-stone-900 overflow-y-auto p-8 flex flex-col relative">
                                                <button 
                                                    onClick={() => setActiveTab('home')}
                                                    className="absolute top-4 right-4 p-2 text-stone-400 hover:text-white z-10">
                                                    <X size={32} />
                                                </button>
                                                <div className="text-center text-stone-500 py-6 font-bold text-2xl">æ¨¡æ“¬çŸ­å½±éŸ³ä¸²æµ</div>
                                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                                    {shortVideos.map(vid => (
                                                        <div key={vid.id} onClick={() => setCurrentVideo(vid)} className={`h-64 ${vid.color} rounded-xl flex items-end p-6 cursor-pointer relative shrink-0 overflow-hidden group shadow-lg`}>
                                                            <div className="absolute inset-0 bg-black/20 group-hover:bg-black/40 transition-colors"></div>
                                                            <div className="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity transform group-hover:scale-110 duration-300">
                                                                <Play className="text-white fill-current drop-shadow-lg" size={64}/>
                                                            </div>
                                                            <div className="text-white z-10 pointer-events-none transform group-hover:-translate-y-2 transition-transform">
                                                                <div className="font-bold text-xl drop-shadow-md leading-tight mb-1">{vid.title}</div>
                                                                <div className="text-sm opacity-90">{vid.tag}</div>
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                )}

                                {/* 7. å°éŠæˆ² (Game Overlay) */}
                                {activeTab === 'game' && (
                                    <div className="h-[calc(100vh-140px)] w-full bg-stone-900 rounded-lg relative overflow-hidden flex flex-col items-center justify-center border border-stone-700 shadow-2xl">
                                        <button 
                                            onClick={() => {
                                                endGame();
                                                setActiveTab('home');
                                            }}
                                            className="absolute top-6 right-6 p-2 bg-black/30 hover:bg-black/50 rounded-full text-stone-400 hover:text-white z-50 transition-colors">
                                            <X size={24} />
                                        </button>

                                        {!gameData.isPlaying && !gameData.isGameOver && (
                                            <div className="text-center p-8 max-w-lg bg-stone-800/50 rounded-2xl backdrop-blur-sm border border-stone-700">
                                                <div className="text-orange-500 mx-auto mb-6 inline-block animate-bounce"><Gamepad2 size={80}/></div>
                                                <h2 className="text-4xl font-bold text-white mb-4">æ‰“èšŠå­ç‰¹è¨“</h2>
                                                <p className="text-stone-300 mb-8 text-lg leading-relaxed">
                                                    è»ç‡ŸèšŠå­ç‰¹åˆ¥å…‡ï¼<br/>
                                                    é™æ™‚ <span className="text-orange-400 font-bold">30 ç§’</span>ï¼Œé»æ“Šè¢å¹•å‡ºç¾çš„èšŠå­ã€‚<br/>
                                                    åˆ¥è®“ç‰ å€‘å®åˆ°ä½ ï¼
                                                </p>
                                                <button 
                                                    onClick={startGame}
                                                    className="bg-orange-600 hover:bg-orange-500 text-white font-bold py-4 px-12 rounded-full text-xl shadow-lg transform hover:scale-105 transition-all"
                                                >
                                                    é–‹å§‹ä»»å‹™
                                                </button>
                                            </div>
                                        )}

                                        {/* Game Play and Game Over UI kept similar but scaled */}
                                        {gameData.isPlaying && (
                                            <div className="w-full h-full relative bg-gradient-to-b from-stone-800 to-stone-900 cursor-crosshair">
                                                <div className="absolute top-6 left-6 right-6 flex justify-between items-center z-10 pointer-events-none">
                                                    <div className="bg-black/50 px-6 py-2 rounded-full text-orange-400 font-mono font-bold text-3xl shadow-lg border border-white/10">
                                                        SCORE: {gameData.score}
                                                    </div>
                                                    <div className={`px-6 py-2 rounded-full font-mono font-bold text-3xl shadow-lg border border-white/10 bg-black/50 ${gameData.timeLeft <= 5 ? 'text-red-500 animate-pulse' : 'text-white'}`}>
                                                        00:{gameData.timeLeft < 10 ? `0${gameData.timeLeft}` : gameData.timeLeft}
                                                    </div>
                                                </div>
                                                {gameData.mosquitoes.map(bug => (
                                                    <div
                                                        key={bug.id}
                                                        onClick={() => hitMosquito(bug.id)}
                                                        className="absolute cursor-pointer transform hover:scale-110 active:scale-90 transition-transform"
                                                        style={{ top: `${bug.top}%`, left: `${bug.left}%` }}
                                                    >
                                                        <Bug size={48} className="text-stone-400 hover:text-red-500 transition-colors drop-shadow-2xl filter" />
                                                    </div>
                                                ))}
                                            </div>
                                        )}

                                        {gameData.isGameOver && (
                                            <div className="text-center p-8 animate-fade-in bg-stone-800/80 rounded-2xl backdrop-blur-md border border-stone-600">
                                                <div className="text-6xl mb-4">ğŸ†</div>
                                                <h2 className="text-3xl font-bold text-white mb-2">ä»»å‹™çµæŸ</h2>
                                                <div className="text-7xl font-mono font-bold text-orange-500 mb-6">{gameData.score}</div>
                                                
                                                <div className="bg-stone-900/80 p-6 rounded-lg mb-8 text-stone-300 max-w-md mx-auto">
                                                    <p className="font-bold text-lg text-white">
                                                        {gameData.score === 0 ? "ä½ åœ¨ç¡è¦ºå—ï¼Ÿ" : 
                                                        gameData.score < 100 ? "æ‰‹è…³å¤ªæ…¢äº†ï¼å»æ—é‚Šä¼åœ°æŒºèº«ï¼" : 
                                                        gameData.score < 200 ? "é‚„ä¸éŒ¯ï¼Œå‹‰å¼·ä¸æœƒè¢«å®æ­»ã€‚" : "å¤ªå¼·äº†ï¼ä½ æ˜¯äººå½¢æ•èšŠç‡ˆï¼"}
                                                    </p>
                                                </div>

                                                <div className="flex gap-4 justify-center">
                                                    <button 
                                                        onClick={startGame}
                                                        className="bg-stone-700 hover:bg-stone-600 text-white py-3 px-8 rounded-lg transition-colors font-bold text-lg"
                                                    >
                                                        å†è©¦ä¸€æ¬¡
                                                    </button>
                                                    <button 
                                                        onClick={() => setActiveTab('home')}
                                                        className="bg-green-700 hover:bg-green-600 text-white py-3 px-8 rounded-lg transition-colors font-bold text-lg"
                                                    >
                                                        è¿”å›æˆ°æƒ…
                                                    </button>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>

                    {/* åº•éƒ¨é¸å–® (Mobile Navigation - Hidden on md+) */}
                    <nav className="md:hidden fixed bottom-0 left-0 right-0 bg-stone-900 border-t border-stone-800 flex justify-around p-3 z-50 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.3)]">
                        <button onClick={() => setActiveTab('home')} className={`flex flex-col items-center gap-1 ${activeTab === 'home' || activeTab === 'game' || activeTab === 'video' ? 'text-green-500' : 'text-stone-500'}`}>
                        <Activity size={20} />
                        <span className="text-[10px]">æˆ°æƒ…</span>
                        </button>
                        <button onClick={() => setActiveTab('training')} className={`flex flex-col items-center gap-1 ${activeTab === 'training' ? 'text-green-500' : 'text-stone-500'}`}>
                        <Dumbbell size={20} />
                        <span className="text-[10px]">è¨“ç·´</span>
                        </button>
                        <button onClick={() => setActiveTab('inventory')} className={`flex flex-col items-center gap-1 ${activeTab === 'inventory' ? 'text-green-500' : 'text-stone-500'}`}>
                        <Briefcase size={20} />
                        <span className="text-[10px]">èƒŒåŒ…</span>
                        </button>
                        <button onClick={() => setActiveTab('chat')} className={`flex flex-col items-center gap-1 ${activeTab === 'chat' ? 'text-green-500' : 'text-stone-500'}`}>
                        <MessageSquare size={20} />
                        <span className="text-[10px]">æ•™å®˜</span>
                        </button>
                        <button onClick={() => setActiveTab('docs')} className={`flex flex-col items-center gap-1 ${activeTab === 'docs' ? 'text-green-500' : 'text-stone-500'}`}>
                        <Menu size={20} />
                        <span className="text-[10px]">è¡Œæ”¿</span>
                        </button>
                    </nav>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>